<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style type="text/css">
 
    .departement {
        cursor: pointer;
    }
 
    .departement:hover {
        stroke: white;
        stroke-width: 1px;
    }
</style>
</head>
<body>
<div id="map"></div>
<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript">
(function() {
 
    var width = 600;
  var height = 400;
 
  /* 
   * On créait un nouvel objet path qui permet 
   * de manipuler les données géographiques.
   */
  var path = d3.geo.path();
 
  // On définit les propriétés de la projection à utiliser
  var projection = d3.geo.conicConformal() // Lambert-93
          .center([2.454071, 47.279229]) // On centre la carte sur la France
          .scale(2000)
          .translate([width / 2, height / 2]);
 
  path.projection(projection); // On assigne la projection au path
 
  /*
   * On créait un nouvel élément svg à la racine de notre div #map,
   * définie plus haut dans le HTML
   */
  var svg = d3.select('#map').append("svg")
      .attr("width", width)
      .attr("height", height);
 
  /*
   * On créait un groupe SVG qui va accueillir
   * tous nos départements
   */
  var deps = svg
        .append("g")
      .attr("id", "regions");
 
  /*
   * On charge les données GeoJSON
   */

  d3.json('regions.json', function(req, geojson) {

 
    /*
     * On "bind" un élément SVG path pour chaque entrée
     * du tableau features de notre objet geojson
     */
    var features = deps
            .selectAll("path")
                .data(geojson.features);
 
        /*
     * On créait un ColorScale, qui va nous
     * permettre d'assigner plus tard une
     * couleur de fond à chacun de nos
     * départements
     */
    var colorScale = d3.scale.category20c();
 
    /*
     * Pour chaque entrée du tableau feature, on
     * créait un élément SVG path, avec les
     * propriétés suivantes
     */
    features.enter()
        .append("path")
            .attr('class', 'regions')
            .attr('fill', function(d) { 
                return colorScale(+d.properties.CODE_DEPT); 
            })
          .attr("d", path)
          .on('click', clickHandler);
 
  });
 
  /*
   * Fonction qui permet de zoomer sur la carte
   * en cliquant sur les départements
   * Récupéré ici : http://bl.ocks.org/mbostock/2206340
   */

  var centered;
  function clickHandler(d) {
    var x, y, k;

    var nomFichier;
    switch(d.properties.Name) {
    case "Nord-Pas-de-Calais et Picardie":
	nomFichier = "./regions/reg9.json";
        break;
    case "Normandie":
	nomFichier = "./regions/reg10.json";
	break;
    case "Île-de-France":
	nomFichier = "./regions/reg7.json";
	break;
    case "Alsace, Champagne-Ardenne et Lorraine":
	nomFichier = "./regions/reg1.json";
	break;
    case "Bourgogne et Franche-Comté":
	nomFichier = "./regions/reg4.json";
	break;
    case "Centre-Val de Loire":
	nomFichier = "./regions/reg6.json";
	break;
    case "Auvergne et Rhône-Alpes":
	nomFichier = "./regions/reg3.json";
	break;
    case "Languedoc-Roussillon et Midi-Pyrénées":
	nomFichier = "./regions/reg8.json";
	break;
    case "Provence-Alpes-Côte d'Azur":
	nomFichier = "./regions/reg12.json";
	break;
    case "Corse":
	nomFichier = "./regions/reg13.json";
	break;
    case "Aquitaine, Limousin et Poitou-Charentes":
	nomFichier = "./regions/reg2.json";
	break;
    case "Pays de la Loire":
	nomFichier = "./regions/reg11.json";
	break;
    case "Bretagne":
	nomFichier = "./regions/reg5.json";
	break;
    default:
	nomFichier = "regions.json";
    }

  /*
   * On créait un groupe SVG qui va accueillir
   * tous nos départements
   */
  var deps = svg
        .append("g")
      .attr("id", "departements");

    d3.json(nomFichier, function(req, geojson) {

    var features = deps
            .selectAll("path")
                .data(geojson.features);

    var colorScale = d3.scale.category20c();

    features.enter()
        .append("path")
            .attr('class', 'departement')
            .attr('fill', function(d) { 
                return colorScale(+d.properties.CODE_DEPT); 
            })
          .attr("d", path);
 
  });
   
    };
 
}());
</script>
</body>
</html>
